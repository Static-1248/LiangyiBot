# LiangyiBot - Screeps AI é¡¹ç›®

ä¸€ä¸ªåŸºäº TypeScript çš„ Screeps æ¸¸æˆ AI é¡¹ç›®ï¼Œé‡‡ç”¨ä¿¡å·é©±åŠ¨æ¶æ„å®ç°é«˜åº¦æ¨¡å—åŒ–å’Œå¯æ‰©å±•çš„è‡ªåŠ¨åŒ–æ®–æ°‘åœ°ç®¡ç†ç³»ç»Ÿã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

LiangyiBot æ˜¯ä¸€ä¸ªå…ˆè¿›çš„ Screeps AIï¼Œä¸“æ³¨äºï¼š
- **æ™ºèƒ½èµ„æºç®¡ç†**ï¼šè‡ªåŠ¨åŒ–çš„é‡‡é›†ã€è¿è¾“å’Œåˆ†é…ç³»ç»Ÿ
- **å»ºç­‘è§„åˆ’**ï¼šåŸºäºäº¤é€šæµé‡çš„é“è·¯è§„åˆ’å’Œå»ºç­‘å¸ƒå±€ä¼˜åŒ–
- **è·¨æˆ¿é—´æ‰©å¼ **ï¼šæ™ºèƒ½çš„ç›¸é‚»æˆ¿é—´æ¢ç´¢å’Œèµ„æºåˆ©ç”¨
- **ä¿¡å·é©±åŠ¨**ï¼šå®Œå…¨è§£è€¦çš„æ¨¡å—é—´é€šä¿¡æœºåˆ¶

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç†å¿µ
é¡¹ç›®é‡‡ç”¨ **ä¿¡å·é©±åŠ¨æ¶æ„**ï¼Œæ‰€æœ‰ç»„ä»¶é€šè¿‡ä¿¡å·ç³»ç»Ÿè¿›è¡Œé€šä¿¡ï¼Œå®ç°é«˜åº¦è§£è€¦å’Œå¯ç»´æŠ¤æ€§ã€‚

### ç›®å½•ç»“æ„
```
src/
â”œâ”€â”€ managers/          # ç®¡ç†å™¨ - è´Ÿè´£é«˜çº§å†³ç­–å’Œèµ„æºåˆ†é…
â”‚   â”œâ”€â”€ SpawnManager.ts        # ç”Ÿäº§ç®¡ç†ï¼šæ™ºèƒ½ç”Ÿæˆcreep
â”‚   â”œâ”€â”€ SupplierManager.ts     # ä¾›ç»™ç®¡ç†ï¼šspawn/extensionèƒ½é‡ä¾›åº”
â”‚   â”œâ”€â”€ MinerManager.ts        # æŒ–çŸ¿ç®¡ç†ï¼šçŸ¿æºåˆ†é…å’Œç›‘æ§
â”‚   â””â”€â”€ SuicideManager.ts      # ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šè€åŒ–creepå¤„ç†
â”œâ”€â”€ creeps/            # Creepç±» - å…·ä½“æ‰§è¡Œå•ä½
â”‚   â”œâ”€â”€ BaseCreep.ts           # åŸºç¡€ç±»ï¼šæ‰€æœ‰creepçš„å…¬å…±åŠŸèƒ½
â”‚   â”œâ”€â”€ MinerCreep.ts          # çŸ¿å·¥ï¼šä¸“ç²¾é‡‡é›†ç‰¹å®šçŸ¿æº
â”‚   â”œâ”€â”€ SupplierCreep.ts       # ä¾›ç»™è€…ï¼šspawn/extensionä¸“ç”¨è¿è¾“
â”‚   â”œâ”€â”€ HaulerCreep.ts         # æ¬è¿å·¥ï¼šé€šç”¨è´§ç‰©è¿è¾“
â”‚   â”œâ”€â”€ BuilderCreep.ts        # å»ºé€ è€…ï¼šå»ºç­‘å»ºé€ å’Œä¿®ç†
â”‚   â””â”€â”€ UpgraderCreep.ts       # å‡çº§è€…ï¼šæ§åˆ¶å™¨å‡çº§ä¸“å®¶
â”œâ”€â”€ planners/          # è§„åˆ’å™¨ - æˆ˜ç•¥è§„åˆ’å’Œä¼˜åŒ–
â”‚   â”œâ”€â”€ BuildingPlanner.ts     # å»ºç­‘è§„åˆ’ï¼šäº¤é€šåˆ†æå’Œé“è·¯è§„åˆ’
â”‚   â””â”€â”€ HarvestPlanner.ts      # é‡‡é›†è§„åˆ’ï¼šçŸ¿æºåˆ†é…å’Œè·¨æˆ¿é—´æŒ–çŸ¿
â”œâ”€â”€ SignalSystem.ts    # ä¿¡å·ç³»ç»Ÿæ ¸å¿ƒ
â”œâ”€â”€ MemoryManager.ts   # å†…å­˜ç®¡ç†å·¥å…·
â””â”€â”€ main.ts           # ä¸»å¾ªç¯å…¥å£
```

### æ¶æ„åˆ†å±‚

```mermaid
graph TB
    subgraph "æˆ˜ç•¥å±‚"
        P[Planners<br/>è§„åˆ’å™¨]
    end
    
    subgraph "ç®¡ç†å±‚"
        M[Managers<br/>ç®¡ç†å™¨]
    end
    
    subgraph "æ‰§è¡Œå±‚"
        C[Creeps<br/>æ‰§è¡Œå•ä½]
    end
    
    subgraph "åŸºç¡€è®¾æ–½"
        S[Signal System<br/>ä¿¡å·ç³»ç»Ÿ]
        MM[Memory Manager<br/>å†…å­˜ç®¡ç†]
    end
    
    P --> M
    M --> C
    S -.-> P
    S -.-> M
    S -.-> C
    MM -.-> P
    MM -.-> M
    MM -.-> C
```

## ğŸ“¡ ä¿¡å·ç³»ç»Ÿ

### è®¾è®¡åŸç†
ä¿¡å·ç³»ç»Ÿæ˜¯æœ¬é¡¹ç›®çš„æ ¸å¿ƒç‰¹è‰²ï¼Œå®ç°äº†ï¼š
- **å®Œå…¨è§£è€¦**ï¼šç»„ä»¶é—´æ— ç›´æ¥ä¾èµ–
- **äº‹ä»¶é©±åŠ¨**ï¼šåŸºäºå‘å¸ƒ-è®¢é˜…æ¨¡å¼
- **ä¼˜å…ˆçº§æ§åˆ¶**ï¼šé‡è¦ä¿¡å·ä¼˜å…ˆå¤„ç†
- **ç±»å‹å®‰å…¨**ï¼šTypeScriptæ”¯æŒçš„å¼ºç±»å‹ä¿¡å·

### åŸºæœ¬ç”¨æ³•

#### å®šä¹‰ä¿¡å·
```typescript
export class ExampleCreep extends BaseCreep {
    constructor(creep: Creep) {
        super(creep);
        
        // å®šä¹‰æ­¤ç±»ä¼šå‘å‡ºçš„ä¿¡å·
        this.defineSignal('example.task_started');
        this.defineSignal('example.task_completed');
    }
}
```

#### å‘å°„ä¿¡å·
```typescript
// å‘å°„ä¿¡å·ï¼Œä¼ é€’æ•°æ®
this.emitSignal('example.task_started', {
    creep: this.creep,
    taskType: 'mining',
    target: source
});
```

#### ç›‘å¬ä¿¡å·
```typescript
// ä½¿ç”¨è£…é¥°å™¨ç›‘å¬ä¿¡å·ï¼Œæ•°å­—è¡¨ç¤ºä¼˜å…ˆçº§ï¼ˆè¶Šå°è¶Šä¼˜å…ˆï¼‰
@signal('example.task_started', 10)
protected onTaskStarted(data: { creep: Creep, taskType: string, target: Source }): void {
    console.log(`ä»»åŠ¡å¼€å§‹: ${data.taskType}`);
}
```

### æ ¸å¿ƒä¿¡å·ç±»å‹

#### Creep ç”Ÿå‘½å‘¨æœŸä¿¡å·
```typescript
'creep.energy_full'      // creepèƒ½é‡æ»¡è½½
'creep.energy_empty'     // creepèƒ½é‡è€—å°½
'creep.state_changed'    // creepçŠ¶æ€å˜åŒ–
'creep.should_suicide'   // éœ€è¦è‡ªæ€ï¼ˆè€åŒ–ç­‰ï¼‰
```

#### èµ„æºç®¡ç†ä¿¡å·
```typescript
'harvest.source_assigned'    // çŸ¿æºåˆ†é…
'harvest.container_full'     // å®¹å™¨å·²æ»¡ï¼Œéœ€è¦hauler
'supplier.energy_crisis'     // èƒ½é‡å±æœºè­¦æŠ¥
```

#### å»ºç­‘è§„åˆ’ä¿¡å·
```typescript
'building.road_planned'         // é“è·¯è§„åˆ’å®Œæˆ
'building.construction_needed'  # éœ€è¦å»ºé€ å»ºç­‘
```

## ğŸ‘¥ Creep è§’è‰²ç³»ç»Ÿ

### è§’è‰²åˆ†å·¥

#### MinerCreepï¼ˆçŸ¿å·¥ï¼‰
- **ä¸“ä¸šæ€§**ï¼šä¸€å¯¹ä¸€ç»‘å®šçŸ¿æºï¼Œæ•ˆç‡æœ€å¤§åŒ–
- **æ™ºèƒ½å®šä½**ï¼šè‡ªåŠ¨å¯»æ‰¾æœ€ä½³æŒ–çŸ¿ä½ç½®
- **å®¹å™¨ç®¡ç†**ï¼šè‡ªåŠ¨å»ºè®®å’Œä½¿ç”¨å®¹å™¨å­˜å‚¨

```typescript
// çŸ¿å·¥ä¼šå‘å‡ºå®¹å™¨éœ€æ±‚ä¿¡å·
this.emitSignal('miner.container_needed', {
    source: source,
    suggestedPos: bestPosition
});
```

#### SupplierCreepï¼ˆä¾›ç»™è€…ï¼‰
- **ä¸“ç”¨è¿è¾“**ï¼šä¸“é—¨ä¸ºspawnå’Œextensionä¾›èƒ½
- **ä¼˜å…ˆçº§ç®¡ç†**ï¼šspawn > extension > tower
- **å±æœºå“åº”**ï¼šèƒ½é‡ä¸è¶³æ—¶è‡ªåŠ¨åˆ‡æ¢ç´§æ€¥æ¨¡å¼

#### HaulerCreepï¼ˆæ¬è¿å·¥ï¼‰
- **ä»»åŠ¡ç³»ç»Ÿ**ï¼šåŸºäºä¼˜å…ˆçº§çš„ä»»åŠ¡åˆ†é…
- **è‡ªä¸»æ¨¡å¼**ï¼šæ— ä»»åŠ¡æ—¶è‡ªåŠ¨å¯»æ‰¾æ¬è¿éœ€æ±‚
- **åŠ¨æ€è°ƒåº¦**ï¼šå“åº”å®æ—¶æ¬è¿è¯·æ±‚ä¿¡å·

#### BuilderCreepï¼ˆå»ºé€ è€…ï¼‰
- **åŒé‡åŠŸèƒ½**ï¼šå»ºé€  + ä¿®ç†
- **æ™ºèƒ½é€‰æ‹©**ï¼šä¼˜å…ˆå»ºé€ ï¼Œå…¶æ¬¡ä¿®ç†
- **çŠ¶æ€ç®¡ç†**ï¼šè£…æ»¡èƒ½é‡å†å·¥ä½œï¼Œæé«˜æ•ˆç‡

#### UpgraderCreepï¼ˆå‡çº§è€…ï¼‰
- **ä¸“ä¸€å‡çº§**ï¼šä¸“æ³¨æ§åˆ¶å™¨å‡çº§
- **å®¹å™¨ä¼˜åŒ–**ï¼šä¼˜å…ˆä½¿ç”¨æ§åˆ¶å™¨é™„è¿‘å®¹å™¨
- **æ•ˆç‡ç›‘æ§**ï¼šè‡ªåŠ¨æ£€æµ‹å’Œå»ºè®®å®¹å™¨ä½ç½®

### ç»Ÿä¸€çŠ¶æ€æœº

æ‰€æœ‰creepéµå¾ªç»Ÿä¸€çš„çŠ¶æ€åˆ‡æ¢é€»è¾‘ï¼š

```typescript
// çŠ¶æ€åˆ‡æ¢ç¤ºä¾‹
if (this.creepMemory.state === 'working' && this.creep.store.energy === 0) {
    this.setState('harvesting');
    this.say('ğŸ”‹å»é‡‡é›†');
}
else if (this.creepMemory.state === 'harvesting' && this.creep.store.getFreeCapacity() === 0) {
    this.setState('working');
    this.say('ğŸ”¨å»å·¥ä½œ');
}
```

## ğŸ§  æ™ºèƒ½è§„åˆ’ç³»ç»Ÿ

### BuildingPlannerï¼ˆå»ºç­‘è§„åˆ’å™¨ï¼‰
- **äº¤é€šåˆ†æ**ï¼šç»Ÿè®¡creepç§»åŠ¨è½¨è¿¹
- **è‡ªåŠ¨é“è·¯**ï¼šè¶…è¿‡10%ä½¿ç”¨ç‡çš„åœ°æ¿è‡ªåŠ¨è§„åˆ’é“è·¯
- **æ•°æ®é©±åŠ¨**ï¼šåŸºäºå®é™…ä½¿ç”¨æ•°æ®åšå†³ç­–

### HarvestPlannerï¼ˆé‡‡é›†è§„åˆ’å™¨ï¼‰
- **çŸ¿æºåˆ†é…**ï¼šæ™ºèƒ½åˆ†é…çŸ¿å·¥åˆ°çŸ¿æº
- **è·¨æˆ¿é—´æŒ–çŸ¿**ï¼šè‡ªåŠ¨æ¢ç´¢ç›¸é‚»æˆ¿é—´èµ„æº
- **å†²çªé¿å…**ï¼šç¡®ä¿æ¯ä¸ªçŸ¿æºä½ç½®ä¸è¿‡è½½

```typescript
// è·¨æˆ¿é—´æŒ–çŸ¿ç¤ºä¾‹
const adjacentRooms = this.getAdjacentRooms(currentRoom);
for (const roomName of adjacentRooms) {
    if (this.isRoomAccessible(roomName)) {
        this.exploreRoom(roomName);
    }
}
```

## ğŸ¨ ä»£ç é£æ ¼æŒ‡å—

### TypeScriptè§„èŒƒ
- **ä¸¥æ ¼ç±»å‹**ï¼šå……åˆ†åˆ©ç”¨TypeScriptç±»å‹ç³»ç»Ÿ
- **æ¥å£å®šä¹‰**ï¼šæ‰€æœ‰æ•°æ®ç»“æ„éƒ½æœ‰æ˜ç¡®æ¥å£
- **æ³›å‹ä½¿ç”¨**ï¼šæé«˜ä»£ç å¤ç”¨æ€§

### æ³¨é‡Šè§„èŒƒ
```typescript
/**
 * æ–¹æ³•åŠŸèƒ½æè¿°
 * @param source å‚æ•°è¯´æ˜
 * @returns è¿”å›å€¼è¯´æ˜
 */
public assignSource(source: Source): void {
    // è¯¦ç»†çš„å®ç°é€»è¾‘æ³¨é‡Š
}
```

### ç¼©è¿›è§„èŒƒ
- **æœ€å¤§å±‚æ•°**ï¼šä»£ç ç¼©è¿›ä¸è¶…è¿‡4å±‚
- **æ—©æœŸè¿”å›**ï¼šä½¿ç”¨guard clauseså‡å°‘åµŒå¥—
- **å‡½æ•°åˆ†è§£**ï¼šå¤æ‚é€»è¾‘æ‹†åˆ†ä¸ºå°å‡½æ•°

```typescript
// âœ… å¥½çš„å†™æ³•
protected doWork(): void {
    if (!this.hasEnergy()) {
        this.startHarvesting();
        return;
    }
    
    if (!this.hasTarget()) {
        this.findTarget();
        return;
    }
    
    this.executeWork();
}

// âŒ é¿å…çš„å†™æ³•
protected doWork(): void {
    if (this.hasEnergy()) {
        if (this.hasTarget()) {
            if (this.canWork()) {
                if (this.isInRange()) {
                    // 4å±‚åµŒå¥—ï¼Œå¤ªæ·±äº†
                }
            }
        }
    }
}
```

### å‘½åè§„èŒƒ
- **ç±»å**ï¼šPascalCaseï¼Œå¦‚ `MinerCreep`
- **æ–¹æ³•å**ï¼šcamelCaseï¼Œå¦‚ `findUnassignedSource`
- **ä¿¡å·å**ï¼šç‚¹åˆ†å‘½åï¼Œå¦‚ `miner.container_needed`
- **å¸¸é‡**ï¼šUPPER_SNAKE_CASE

## ğŸš€ è¿è¡Œæœºåˆ¶

### ä¸»å¾ªç¯
```typescript
// main.ts
export function loop() {
    // 1. å†…å­˜æ¸…ç†
    clearDeadCreeps();
    
    // 2. ç®¡ç†å™¨æ›´æ–°
    updateManagers();
    
    // 3. è§„åˆ’å™¨è¿è¡Œ
    updatePlanners();
    
    // 4. Creepæ‰§è¡Œ
    runCreeps();
}
```

### å¯åŠ¨æµç¨‹
1. **å†…å­˜åˆå§‹åŒ–**ï¼šåŠ è½½æˆ–åˆ›å»ºæˆ¿é—´è®°å¿†æ•°æ®
2. **ä¿¡å·ç³»ç»Ÿå¯åŠ¨**ï¼šæ³¨å†Œæ‰€æœ‰ä¿¡å·ç›‘å¬å™¨
3. **ç®¡ç†å™¨åˆå§‹åŒ–**ï¼šSpawnManagerå¼€å§‹è¯„ä¼°ç”Ÿäº§éœ€æ±‚
4. **è§„åˆ’å™¨å¯åŠ¨**ï¼šå¼€å§‹åˆ†ææˆ¿é—´å¸ƒå±€å’Œèµ„æºåˆ†å¸ƒ
5. **Creepæ¿€æ´»**ï¼šç°æœ‰creepå¼€å§‹æ‰§è¡Œä»»åŠ¡

### æ‰©å±•æŒ‡å—

#### æ·»åŠ æ–°çš„Creepè§’è‰²
1. ç»§æ‰¿ `BaseCreep`
2. å®šä¹‰è§’è‰²ç‰¹æœ‰ä¿¡å·
3. å®ç° `doWork()` æ–¹æ³•
4. åœ¨å¯¹åº”Managerä¸­æ·»åŠ ç”Ÿäº§é€»è¾‘

#### æ·»åŠ æ–°çš„è§„åˆ’å™¨
1. åˆ›å»ºè§„åˆ’å™¨ç±»
2. å®šä¹‰è§„åˆ’ç›¸å…³ä¿¡å·
3. åœ¨ä¸»å¾ªç¯ä¸­æ³¨å†Œ
4. é€šè¿‡ä¿¡å·ä¸å…¶ä»–ç»„ä»¶äº¤äº’

#### æ·»åŠ æ–°ä¿¡å·
1. åœ¨ç›¸å…³ç±»ä¸­å®šä¹‰ä¿¡å·ï¼š`this.defineSignal('new.signal')`
2. å‘å°„ä¿¡å·ï¼š`this.emitSignal('new.signal', data)`
3. ç›‘å¬ä¿¡å·ï¼š`@signal('new.signal', priority)`

## ğŸ”§ è°ƒè¯•ä¸ç›‘æ§

### ä¿¡å·è°ƒè¯•
```typescript
// å¼€å¯ä¿¡å·è°ƒè¯•æ—¥å¿—
console.log(`ğŸ“¡ ä¿¡å·å‘å°„: ${signalName}`, data);
```

### æ€§èƒ½ç›‘æ§
- **CPUä½¿ç”¨ç‡**ï¼šç›‘æ§å„æ¨¡å—CPUæ¶ˆè€—
- **å†…å­˜ä½¿ç”¨**ï¼šå®šæœŸæ¸…ç†æ— ç”¨å†…å­˜æ•°æ®
- **ä¿¡å·é¢‘ç‡**ï¼šé¿å…ä¿¡å·é£æš´

### å¸¸è§é—®é¢˜
1. **Creepå¡ä½**ï¼šæ£€æŸ¥è·¯å¾„è§„åˆ’å’Œç›®æ ‡æœ‰æ•ˆæ€§
2. **ä¿¡å·ä¸¢å¤±**ï¼šç¡®è®¤ä¿¡å·åç§°æ‹¼å†™å’Œç›‘å¬å™¨æ³¨å†Œ
3. **å†…å­˜æ³„æ¼**ï¼šåŠæ—¶æ¸…ç†æ­»äº¡creepçš„å†…å­˜æ•°æ®

## ğŸ“š æ‰©å±•é˜…è¯»

- [Screepså®˜æ–¹æ–‡æ¡£](https://docs.screeps.com/)
- [TypeScriptå®˜æ–¹æ‰‹å†Œ](https://www.typescriptlang.org/docs/)
- ä¿¡å·é©±åŠ¨æ¶æ„è®¾è®¡æ¨¡å¼

---

**é¡¹ç›®ç»´æŠ¤è€…**: è¯·åœ¨ä¿®æ”¹æ ¸å¿ƒæ¶æ„æ—¶æ›´æ–°æ­¤æ–‡æ¡£
**è´¡çŒ®æŒ‡å—**: éµå¾ªç°æœ‰ä»£ç é£æ ¼ï¼Œä¼˜å…ˆä½¿ç”¨ä¿¡å·é€šä¿¡è€Œéç›´æ¥è°ƒç”¨
